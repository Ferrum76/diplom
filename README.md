# Прогнозирование Цен на Основе Исторических Данных и Анализа Рынка

### Описание задачи:

Вы работаете в компании, которая продвигает свой товар на разных рынках, и у компании есть конкуренты. Отдел аналитики предоставил исторические данные по ценам, количеству продаж, затратам на продвижение товара, а также базу данных с ценами конкурентов на аналогичный продукт. Компания находится на этапе составления прогноза цен на основании этих параметров.

### Задача

Разработать алгоритм, который будет прогнозировать ценообразование на определенном рынке на основе предоставленных данных из CSV файла.

### Дополнительные данные

- Чтобы скачать фалй [csv_data.csv](https://prod-files-secure.s3.us-west-2.amazonaws.com/0771f0bb-b4cb-4a14-bc05-94cbd33fc70d/9d4fd89c-65f0-4554-a367-7943861ba310/csv_data.csv)
- Для локального пользоыания [csv_data.csv](./csv_data.csv)


Данные представлены в формате CSV и содержат следующие столбцы:

- `price` — цена товара
- `count` — количество продаж
- `add_cost` — затраты на продвижение товара
- `company` — компания-производитель товара
- `product` — наименование продукта

### Требования:

1. Разработать алгоритм прогнозирования цен на основании данных из CSV файла, включая:
    - Исторические данные по ценам.
    - Количество продаж.
    - Затраты на продвижение товара.
    - Цены конкурентов на аналогичный продукт.
2. Сохранение и обработка данных в базе данных.
3. Регулярное обновление модели прогнозирования с новыми данными.

### Технические требования:

- Язык программирования: Python 3.11
- Код размещен в открытом репозитории (Git).
- Код покрыт тестами с покрытием не менее 75%.
- Код оформлен согласно PEP8.
- Доступна документация (Readme файл).
- Работа с входными данными в формате CSV.
- Решение должно быть оптимальным с точки зрения алгоритмической сложности.

---
## Описание

Данный проект предназначен для прогнозирования цен на определенном рынке на основе исторических данных компании, включая цены, количество продаж, затраты на продвижение, а также информацию о компании и продукте. Алгоритм использует методы машинного обучения для построения модели прогнозирования.

## Структура Проекта

- `database.py`: Классы для работы с базой данных SQLite.
- `model.py`: Класс `PricePredictor` для построения и обновления модели прогнозирования.
- `main.py`: Основной файл для запуска процесса прогнозирования с интерактивным вводом пользователя.
- `tests/`: Модульные тесты для проверки функциональности.
- `csv_data.csv`: Входные данные для анализа.
- `README.md`: Документация по проекту.

## Установка и Запуск

1. **Клонирование Репозитория**

   ```bash
   git clone https://github.com/your-repo-url.git
   cd your-repo
   ```
2. **Установка Зависимостей**

   ```bash
   pip install -r requirements.txt
   ```
3. **Запуск Программы**

   ```bash
   python3 main.py
   ```
4. **Ввод Данных**
- Следуйте инструкциям программы для ввода данных о количестве продаж, затратах на продвижение, компании и продукте.

## Тестирование

Тестирование производится с помощью модульных тестов. Входные данные для анализа представлены в `csv_data.csv`.
    
   ```bash
   python3 -m unittest discover tests
   ```

Вывод покрыт тестами

```bash
python3 -m coverage run -m unittest discover tests
```
```bash
coverage report -m

Name                     Stmts   Miss  Cover   Missing
------------------------------------------------------
src/database.py             17      0   100%
src/models.py               56      2    96%   87-88
tests/test_database.py      22      1    95%   42
tests/test_models.py        42      1    98%   74
------------------------------------------------------
TOTAL                      137      4    97%
```

##  Технические Требования
- Язык Программирования: Python 3.11
- Библиотеки:
  - pandas
  - scikit-learn
  - sqlite3
  - joblib
- База Данных: SQLite

##   Алгоритм
1. **Загрузка Данных**: Данные загружаются из файла csv_data.csv и сохраняются в базу данных SQLite.

2. **Предобработка Данных**: Выполняется очистка данных и преобразование категориальных признаков с помощью One-Hot Encoding.

3. **Обучение Модели**: Модель градиентного бустинга обучается на предобработанных данных.

4. **Оценка Модели**: Выводятся метрики качества модели и важность признаков.

5. **Прогнозирование**: Пользователь вводит новые данные, и модель прогнозирует цену с выводом подробного анализа.

---
## Пример выполнения в консоле с данными 
```bash
Инициализация менеджера базы данных...
Загрузка данных из 'csv_data.csv'...
Вставка данных в базу данных...
Инициализация модели прогнозирования цен...
Обучение модели на загруженных данных...
Получение данных из базы данных для обучения модели...
Разделение данных на обучающую и тестовую выборки...
Обучение модели градиентного бустинга...
Оценка модели на тестовой выборке...
Среднеквадратичная ошибка на тестовой выборке: 676452878.96
Важность признаков:
add_cost                     0.453249
count                        0.269847
id                           0.033490
company_Oracle               0.020008
product_Raspberry Pi         0.014921
product_Echo                 0.014242
company_Microsoft            0.014064
product_Galaxy Tab           0.013925
product_Echo Dot             0.013716
product_iPhone               0.012865
product_FireTV               0.012728
company_Samsung              0.011614
company_Google               0.009917
product_Surface              0.009436
product_Chromebook           0.009001
product_PlayStation          0.008711
company_Apple                0.008614
product_Pixel                0.007934
product_Kindle               0.007885
product_Surface Pro          0.007599
company_Intel                0.006481
product_Apple Watch          0.006022
product_Kindle Paperwhite    0.004902
product_Xbox                 0.004864
company_Amazon               0.004667
company_IBM                  0.003699
company_Facebook             0.003669
company_Tesla                0.003638
product_Oculus               0.002694
product_Nest                 0.002586
product_Galaxy               0.002044
product_MacBook              0.000530
product_ThinkPad             0.000437
dtype: float64
Получение данных из базы данных для обучения модели...
Разделение данных на обучающую и тестовую выборки...
Обучение модели градиентного бустинга...
Оценка модели на тестовой выборке...
Среднеквадратичная ошибка на тестовой выборке: 676452738.42
Важность признаков:
add_cost                     0.453434
count                        0.269855
id                           0.033481
company_Oracle               0.019739
product_Raspberry Pi         0.014921
product_Echo                 0.014242
company_Microsoft            0.014064
product_Galaxy Tab           0.013925
product_Echo Dot             0.013716
product_iPhone               0.012865
product_FireTV               0.012728
company_Samsung              0.011369
company_Google               0.009917
product_Surface              0.009436
product_Chromebook           0.009001
company_Apple                0.008762
product_PlayStation          0.008562
product_Pixel                0.007934
product_Kindle               0.007885
product_Surface Pro          0.007599
company_Intel                0.006481
product_Apple Watch          0.006022
product_Kindle Paperwhite    0.005147
product_Xbox                 0.004864
company_Amazon               0.004667
company_IBM                  0.003699
company_Facebook             0.003669
company_Tesla                0.003638
product_Oculus               0.002819
product_Nest                 0.002586
product_Galaxy               0.002044
product_ThinkPad             0.000472
product_MacBook              0.000455
dtype: float64
Модель сохранена в 'price_model.pkl'.

=== Обучение завершено ===


Введите данные для прогнозирования цены:
Количество продаж (count): 500
Затраты на продвижение (add_cost): 2000
Компания-производитель (company): Apple
Наименование продукта (product): Iphone

Анализ введенных данных и прогнозирование цены...
Предобработка введенных данных...
Выполнение прогноза цены...

Прогнозируемая цена для продукта 'iphone' от компании 'aplle': 55089.95

Программа завершена.
```
---

## Объяснение Алгоритма

**Сбор Данных**: Загружаем данные из файла `csv_data.csv`, который содержит исторические данные о ценах, количестве продаж, затратах на продвижение, компании и продукте. Данные сохраняются в базе данных для дальнейшей обработки.

**Предобработка Данных**: Выполняем очистку данных, удаляем пропущенные значения и преобразуем категориальные признаки (`company`, `product`) в числовые с помощью One-Hot Encoding. Это необходимо для корректной работы модели машинного обучения.

**Обучение Модели**: Используем градиентный бустинг (`GradientBoostingRegressor`), который хорошо справляется с задачами регрессии и способен улавливать сложные зависимости в данных.

**Оценка Модели**: После обучения модели на обучающей выборке оцениваем ее качество на тестовой выборке, выводя среднеквадратичную ошибку. Также выводим важность признаков, чтобы понять, какие факторы наиболее сильно влияют на цену.

**Интерактивное Прогнозирование**: Предоставляем пользователю возможность вводить новые данные и получать прогноз цены. Во время работы программы выводится подробный текстовый анализ каждого шага, чтобы пользователь понимал, что происходит внутри.

**Регулярное Обновление**: Модель сохраняется в файл `price_model.pkl` для возможности ее последующей загрузки и обновления с новыми данными.

---

## Преимущества Используемого Подхода

- **Простота и Масштабируемость**: Использование SQLite обеспечивает легкость развертывания и не требует установки дополнительного ПО.
- **Точность Прогнозов**: Использование градиентного бустинга позволяет достичь высокой точности при прогнозировании цен.
- **Понятность**: Подробные выводы во время работы программы помогают пользователю понять, как работает модель и на что обращать внимание.
- **Гибкость**: Возможность обновления модели с новыми данными позволяет системе адаптироваться к изменениям рынка.
